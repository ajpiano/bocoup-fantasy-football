<html>
	<head>
		<title>Bocoup Fantasy Football</title>

 		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

		<link rel="shortcut icon" href="favico.ico"/>
		<link href="css/flick/jquery-ui-1.10.3.custom.css" rel="stylesheet">
		<link media="screen" rel="stylesheet" type="text/css" href="css/normalize.css"> 
		<link media="screen" rel="stylesheet" type="text/css" href="css/site.css"> 
	</head>

<body>
	<h1>Bocoup Fantasy Football</h1>
	<ul class="positions">
		<li>1 QB</li>
		<li>2 RB</li>
		<li>2 WR</li>
		<li>1 TE</li>
		<li>1 WR/RB/TE</li>
		<li>1 K</li>
		<li>1 DEF</li>
		<li>6 Bench</li>
	</ul>
	<div id="tabs">
		<ul>
			<li><a href="#tabs-1">Available Players</a></li>
			<li id="tabs-2-link"><a href="#tabs-2">Teams</a></li>
		</ul>
		<div id="tabs-1">
			<table id="availablePlayersTable"></table>
		</div>
		<div id="tabs-2" class="cf">
		</div>
	</div><!-- end wrapper -->

	<script src="js/ICanHaz.js"></script>
	<script src="js/lodash.js"></script>
	<script src='js/jquery.js'></script>
	<script src='js/jquery-ui.js'></script>
	<script src='js/jquery.dataTables.min.js'></script>
	<script src='js/tabletop.js'></script>
	<script src='js/sheetsee.js'></script>

	<script id="availablePlayersTable" type="text/html">
		<thead>
			<tr>
				<td></td>
				<td></td>
				<td><input type="text" name="lastname" placeholder="Filter Last Name"></td>
				<td><input type="text" name="firstname" placeholder="Filter First Name"></td>
				<td><input type="text" name="team" placeholder="Filter Team"></td>
				<td><input type="text" name="position" placeholder="Filter Position"></td>
				<td></td>
			</tr>
			<tr>
				<th class="rank_col">Yahoo!<br />Rank</th>
				<th class="rank_col">ESPN<br />Rank<br />
				<th class="lt">Last Name</th>
				<th class="lt">First Name</th>
				<th>Team</th>
				<th>Pos</th>
				<th class="bye_col">Bye</th>
			</tr>
		</thead>
		<tbody>
		  {{#rows}}
		  	<tr id="{{rowNumber}}" class="spotRow">
		  		<td class="rt">{{rank}}</td>
		  		<td class="rt">{{espnrank}}</td>
		  		<td>{{lastname}}</td>
		  		<td>{{firstname}}</td>
		  		<td class="ctr cap">{{team}}</td>
		  		<td class="ctr">{{pos}}</td>
		  		<td class="rt">{{bye}}</td>
	  		</tr>
		  {{/rows}}
		</tbody>
	</script>

	<script id="teamTable" type="text/html">
		<table class="teamTable" id="{{owner}}">
			<thead>
				<tr>
					<th class="owner" colspan="5">{{owner}}</th>
				</tr>
				<tr>
					<th>Pos</th>
					<th>Last Name</th>
					<th>First Name</th>
					<th>Team</th>
					<th>Bye</th>
				</tr>
			</thead>
		</table>
	</script>

	<script id="teamTableBody" type="text/html">
		<tbody>
			<tr class="qb">
				<th class="ctr">QB</th>
			</tr>
			<tr class="wr">
				<th class="ctr">WR</th>
			</tr>
			<tr class="wr">
				<th class="ctr">WR</th>
			</tr>
			<tr class="wrt">
				<th class="ctr">W/R/T</th>
			</tr>
			<tr class="rb">
				<th class="ctr">RB</th>
			</tr>
			<tr class="rb">
				<th class="ctr">RB</th>
			</tr>
			<tr class="te">
				<th class="ctr">TE</th>
			</tr>
			<tr class="k">
				<th class="ctr">K</th>
			</tr>
			<tr class="def">
				<th class="ctr">DEF</th>
			</tr>
			<tr class="bn">
				<th class="ctr">BN</th>
			</tr>
			<tr class="bn">
				<th class="ctr">BN</th>
			</tr>
			<tr class="bn">
				<th class="ctr">BN</th>
			</tr>
			<tr class="bn">
				<th class="ctr">BN</th>
			</tr>
			<tr class="bn">
				<th class="ctr">BN</th>
			</tr>
			<tr class="bn">
				<th class="ctr">BN</th>
			</tr>
		</tbody>
	</script>

	<script id="rosterLine" type="text/html">
		<td>{{lastname}}</td>
		<td>{{firstname}}</td>
		<td class="ctr cap">{{team}}</td>
		<td class="rt">{{bye}}</td>
	</script>

	<script type="text/javascript">
		$(function() {
		
	  	var URL = "0ArJmbb-pdH1sdDJHVTBmQmh5d0RRUjh4V2RWQlNORWc"
			Tabletop.init( { key: URL, callback: showInfo, simpleSheet: true } ) 

			$( "#tabs" ).tabs();

			$( '.clear' ).on('click', function(){
				$(this).closest( '.tableFilter' ).val('');
			});

		  function showInfo(data) {
		  	var gData = data;

		  	buildAvailablePlayersTable();
		  	buildTeamTables();

				function buildTeamTables() {
					var currentPlayer = null;
					var currentTeam = null;
					var currentRoster = null;
					var rosterLength = 0;
			  	var teamTableBody = ich.teamTableBody();

			  	var teams = _.without( _.uniq( _.pluck( gData, 'draftedby' ) ), '');
			  	var numTeams = teams.length;

			  	if (numTeams) {

			  		$('#tabs-2-link').show();

				  	for (var i = 0; i < numTeams; i++) {
				  		currentTeam = teams[i];
				  		currentRoster = Sheetsee.getMatches(gData, currentTeam, 'draftedby');
				  		rosterLength = currentRoster.length;

					  	$( '#tabs-2' ).append( $( ich.teamTable({owner: teams[i]}) ).append( teamTableBody ) );

					  	for( var j = 0; j < rosterLength; j++ ) {
					  		$('#' + currentTeam).find('.' + currentRoster[j].posdrafted + ' th:only-child').parent().eq(0).append( ich.rosterLine(currentRoster[j]));

					  	}

				  	}

			  	}

				}

				function buildAvailablePlayersTable() {

			  	var availablePlayers = Sheetsee.getMatches(gData, '', 'draftedby');

			  	Sheetsee.makeTable(availablePlayers, "#availablePlayersTable");

					var dataTable = $( '#availablePlayersTable' ).dataTable({
						bPaginate: false,
						bJQueryUI: true
					});

					$( '#availablePlayersTable thead input' ).on( 'keyup', function() {
						dataTable.fnFilter( this.value, $('#availablePlayersTable thead input').index(this) + 2 );
					});		
				}

		 	}
		});

	</script>
</body>
</html>
